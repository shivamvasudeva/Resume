name: Deploy-to-S3-and-Update-HTML

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to S3 and Update HTML
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      # Add this step to configure git with the personal access token
      - name: Configure Git
        run: |
          git config --global user.email "sv5@live.in"
          git config --global user.name "shivamvasudeva"
          git remote set-url origin https://github.com/${{ github.repository }}.git
          git fetch
          git pull

      - name: Upload files to S3
        uses: jakejarvis/s3-sync-action@master
        with:
          args: --acl public-read --delete
        env:
          AWS_S3_BUCKET: ${{ secrets.AWS_S3_BUCKET }}
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          SOURCE_DIR: . # Assuming your files are at the root of the repository

      - name: Get uploaded file URL
        id: get_file_url
        run: echo "::set-output name=url::https://${{ secrets.AWS_S3_BUCKET }}.s3.amazonaws.com/files/$(basename */*.pdf)"

      - name: DebugURL
        run: echo "URL from get_file_url step:${{ steps.get_file_url.outputs.url }}"

      - name: Update HTML with file URL
        run: sed -i "s|resume_pdf_s3url|${{ steps.get_file_url.outputs.url }}|g" index.html
      - name: Commit and push updated HTML
        run: |
          git add index.html # Replace 'index.html' with the path to your HTML file
          git commit -m "Update HTML with new file URL"
          git push origin main
